write.csv(F1_carbchem_ShannonQC.final, "C:/Users/samjg/Documents/Github_repositories/EAD-ASEB-Airradians_F1F2_Growout_OA/RAnalysis/Output/SeawaterChemistry/F1/master/CarbChem_Shannon_master.csv")
F1_carbchem_ShannonQC.final
F1_carbchem_ShannonQC <- F1_ShannonQC %>%
dplyr::select(Date, Treatment, Replicate,
Temperature_bucket_C, Salinity,
TCO2_mmol_kgSW, pCO2, TA_mmol_kgSW,
pH_out, Wca_out, War_out) %>%
dplyr::rename(WCa_out = Wca_out,
WAr_out = War_out)
F1_carbchem_ShannonQC                <- F1_carbchem_ShannonQC[!(is.na(F1_carbchem_ShannonQC$WAr_out)),]
F1_carbchem_ShannonQC.flagged.DIC.TA <- subset(F1_carbchem_ShannonQC, (TCO2_mmol_kgSW > TA_mmol_kgSW)) # 13 rows flagged for DIC<TA
F1_carbchem_ShannonQC.final <- subset(F1_carbchem_ShannonQC, !(TCO2_mmol_kgSW > TA_mmol_kgSW)) %>% # DIC>TA omit
#dplyr::filter(WAr_out < 3) %>% # omit these odd aragonite points
dplyr::mutate(pCO2_treatment =
case_when(Treatment == 8.0 ~ 'Low',
Treatment == 7.5 ~ 'Moderate',
Treatment == 7.0 ~ 'Severe'),
Generation = 'F1')
F1_carbchem_ShannonQC
F1_carbchem_ShannonQC
F1_carbchem_ShannonQC
F1_ShannonQC
# ..after a year+ past I was pinged in august 2025 to replot the figures and was emailed this sheet loaded below.
# note that there are many empty rows, the raw data was not touched, only edited in R
F1_ShannonQC <-       read.csv(file="Data/SeawaterChemistry/F1/Carbonate_Chemistry_Figure_Shannon202508.csv", header=TRUE) %>% # load the chem data
na.omit() %>%  # omit all those NAs in her sprreadsheet
dplyr::mutate(Treatment = case_when(
OA_treatment %in% 'low' ~ 8,
OA_treatment %in% 'moderate' ~ 7.5,
OA_treatment %in% 'high' ~ 8 # this sheet does not have high, just doing it anyway though
))  %>% # for simplicity, rename to match the master files I created and wrote this script for
dplyr::rename(Replicate = Bin_ID,
Temperature_bucket_C = t.oC._of_bucket,
pH_out = pH_Chosen_scale,
Wca_out = Calcite,
War_out = Aragonite)
F1_ShannonQC
# ..after a year+ past I was pinged in august 2025 to replot the figures and was emailed this sheet loaded below.
# note that there are many empty rows, the raw data was not touched, only edited in R
F1_ShannonQC <-       read.csv(file="Data/SeawaterChemistry/F1/Carbonate_Chemistry_Figure_Shannon202508.csv", header=TRUE) %>% # load the chem data
na.omit() %>%  # omit all those NAs in her sprreadsheet
dplyr::mutate(Treatment = case_when(
OA_treatment %in% 'low' ~ 8,
OA_treatment %in% 'moderate' ~ 7.5,
OA_treatment %in% 'high' ~ 8 # this sheet does not have high, just doing it anyway though
))  %>% # for simplicity, rename to match the master files I created and wrote this script for
dplyr::rename(Replicate = Bin_ID,
Temperature_bucket_C = t.oC._of_bucket,
pH_out = pH_Chosen_scale,
Wca_out = Calcite,
War_out = Aragonite)
# F2
F2_chem_pre        <- read.csv(file="Data/SeawaterChemistry/F2/F2_water_chemistry_pre_overwinter_raw.csv", header=TRUE) # load the chem data
F2_chem_post       <- read.csv(file="Data/SeawaterChemistry/F2/F2_water_chemistry_post_overwinter_raw.csv", header=TRUE) # load the chem data
F1_carbchem_ShannonQC <- F1_ShannonQC %>%
dplyr::select(Date, Treatment, Replicate,
Temperature_bucket_C, Salinity,
TCO2_mmol_kgSW, pCO2, TA_mmol_kgSW,
pH_out, Wca_out, War_out) %>%
dplyr::rename(WCa_out = Wca_out,
WAr_out = War_out)
# NOTe: full carbonate chemistry was taken non-continuosly, call all rows that contain full carb
F1_carbchem_ShannonQC                <- F1_carbchem_ShannonQC[!(is.na(F1_carbchem_ShannonQC$WAr_out)),]
F1_carbchem_ShannonQC.flagged.DIC.TA <- subset(F1_carbchem_ShannonQC, (TCO2_mmol_kgSW > TA_mmol_kgSW)) # 13 rows flagged for DIC<TA
# write.csv(carbchem.flagged.odd, "C:/Users/samjg/Documents/Github_repositories/Airradians_multigen_OA/RAnalysis/Output/SeawaterChemistry/F1/flagged_data.csv")
F1_carbchem_ShannonQC.final <- subset(F1_carbchem_ShannonQC, !(TCO2_mmol_kgSW > TA_mmol_kgSW)) %>% # DIC>TA omit
#dplyr::filter(WAr_out < 3) %>% # omit these odd aragonite points
dplyr::mutate(pCO2_treatment =
case_when(Treatment == 8.0 ~ 'Low',
Treatment == 7.5 ~ 'Moderate',
Treatment == 7.0 ~ 'Severe'),
Generation = 'F1')
write.csv(F1_carbchem_ShannonQC.final, "C:/Users/samjg/Documents/Github_repositories/EAD-ASEB-Airradians_F1F2_Growout_OA/RAnalysis/Output/SeawaterChemistry/F1/master/CarbChem_Shannon_master.csv")
F1_carbchem_ShannonQC.final
names(F2_chem_pre)
F2_chem_pre.OM <- F2_chem_pre %>% dplyr::mutate(Treatment =
case_when(Replicate.color %in% 'green/purple' ~ 7.0,
TRUE ~ Treatment)
) %>%
tidyr::drop_na(Wca_out) %>%
dplyr::select(Date, Treatment, Replicate,
Temperature_bucket_C, Salinity, DO_mg_l,
pH_out, pCO2_out_matm, Wca_out, War_out_DIC_pH) %>%
dplyr::rename(WCa_out = Wca_out,
WAr_out = War_out_DIC_pH)
F2_chem_pre.REP.SUMM <- F2_chem_pre.OM %>% dplyr::select(c(Date, Treatment)) %>%
dplyr::group_by_all() %>%
dplyr::summarise(n=n())
length(unique(F2_chem_pre.REP.SUMM$Date)) # 31 dates when measured over this period!
F2_chem_post.OM <- F2_chem_post %>%
tidyr::drop_na(Temperature_spec_C)
F2_chem_post.REP.SUMM <- F2_chem_post.OM %>% dplyr::select(c(Date, Treatment)) %>%
dplyr::group_by_all() %>%
dplyr::summarise(n=n())
length(unique(F2_chem_post.REP.SUMM$Date)) # 33 dates when measured over this period!
#  call the core datasets
F2_chem_post.core.columns   <- F2_chem_post[,c(1,3:4,6:8)]
F2_chem_post.DIC_pH.columns <- F2_chem_post[ ,grepl( ("DIC_pH"), names(F2_chem_post) ) ]
names(F2_chem_post.DIC_pH.columns) = gsub(pattern = "_DIC_pH.*", replacement = "", x = names(F2_chem_post.DIC_pH.columns))
F2_chem_post.DIC_pH         <- cbind(F2_chem_post.core.columns, F2_chem_post.DIC_pH.columns)
F2_chem_post.TA_pH.columns        <- F2_chem_post[ ,grepl( ("TA_pH"), names(F2_chem_post) ) ]
names(F2_chem_post.TA_pH.columns) = gsub(pattern = "_TA_pH.*", replacement = "", x = names(F2_chem_post.TA_pH.columns))
F2_chem_post.TA_pH                <- cbind(F2_chem_post.core.columns, F2_chem_post.TA_pH.columns)
# Use full_join to merge the DIC_pH with the TA_pH dataframe
# this method below ensures ALL cased when we have DIC_pH are prioritizes
# cases when DIC was broken (NAs for DIC_pH carb chem) are filled with TA_pH calculated data
# this is wat we discussed with Shannon - use TA-PH when DIC was broken, otherwise DIC_pH whenever able
F2_chem_post_final <- dplyr::full_join(F2_chem_post.DIC_pH, F2_chem_post.TA_pH,
by = c("Date", "Treatment", "Replicate",
"Temperature_bucket_C", "Salinity", "DO_mg_l"), suffix = c("", ".y")) %>%
mutate(across( names(F2_chem_post.TA_pH.columns),
~ coalesce(., cur_data()[[ paste0(cur_column(), ".y") ]]))) %>%
select(-ends_with(".y")) %>%
na.omit() %>%
dplyr::select(Date, Treatment, Replicate,
Temperature_bucket_C, Salinity, DO_mg_l,
pH_out, pCO2_out_.matm., WCa_out, WAr_out) %>%
dplyr::rename(pCO2_out_matm = pCO2_out_.matm.)
# sanity check, are the names the same?
names(F2_chem_post_final) == names(F2_chem_pre.OM)
F2_carbchem.final <- rbind(F2_chem_pre.OM, F2_chem_post_final) %>%
dplyr::mutate(pCO2_treatment =
case_when(Treatment == 8 ~ 'Low',
Treatment == 7.5 ~ 'Moderate',
Treatment == 7 ~ 'Severe'),
Generation = 'F2')
F2_carbchem.final
# F2 data have outliers that are also easily filtered out by calcite saturation state < 2.0 in the low treatment
F2_carbchem.final.OM <- F2_carbchem.final %>% dplyr::filter(!(pCO2_treatment %in% 'Low' &
WCa_out < 2.0))
# run the same code with '!' to callthese datapoint ONLY and output them as 'flagged'
F1_carbchem.flagged <- F1_carbchem.final %>% dplyr::filter((pCO2_treatment %in% 'Low' &
WCa_out < 1.7))
F2_carbchem.flagged <- F2_carbchem.final %>% dplyr::filter((pCO2_treatment %in% 'Low' &
WCa_out < 2.0))
names(F1_carbchem.final) == names(F1_carbchem.final) # must be TRUE meaning the columnnames are exactly the same and we can merge successfully
# F1 data shows ouliers that are simply omitted by the calcite sat state < 1.7 in the low treatment
F1_carbchem.final.OM <- F1_carbchem.final %>% dplyr::filter(!(pCO2_treatment %in% 'Low' &
WCa_out < 1.7))
# F2 data have outliers that are also easily filtered out by calcite saturation state < 2.0 in the low treatment
F2_carbchem.final.OM <- F2_carbchem.final %>% dplyr::filter(!(pCO2_treatment %in% 'Low' &
WCa_out < 2.0))
# run the same code with '!' to callthese datapoint ONLY and output them as 'flagged'
F1_carbchem.flagged <- F1_carbchem.final %>% dplyr::filter((pCO2_treatment %in% 'Low' &
WCa_out < 1.7))
F2_carbchem.flagged <- F2_carbchem.final %>% dplyr::filter((pCO2_treatment %in% 'Low' &
WCa_out < 2.0))
# now proceed with 'F1_carbchem.final.OM'
# ALL
# change to long format to properly facet
carbchem.MASTER_long <- rbind(F1_carbchem.final.OM, F2_carbchem.final.OM) %>%
dplyr::select(!c(Treatment)) %>%
dplyr::filter(Replicate %in% c('A','B','C','D','E','F','G','H')) %>%
melt(id.vars=c('Date', 'Replicate', 'Generation', 'pCO2_treatment')) %>%
na.omit() %>%
dplyr::mutate(Date =
as.POSIXct(Date, format = "%m/%d/%Y"),
Month = months(Date),
Year  = lubridate::year(Date))
carbchem.MASTER_long$value <- as.numeric(carbchem.MASTER_long$value) # make numeric
# MEANS PER SAMPLING DAY (reducing replicates within treatment to one mean)
# aquire means by group for mean SE plotting by Date and treamtent
carbchem.MEANS.by.day <- carbchem.MASTER_long %>% # calc means and standard error
dplyr::group_by(Date, pCO2_treatment, Generation, variable) %>%
dplyr::summarise(mean = mean(value),
sd   = sd(value),
se   = sd/(sqrt(n())),
n = n())
# how do we get smooth geom ribbon figures
# in summary run gam and use a fine scale for x axis
# https://stackoverflow.com/questions/61029929/smoothing-geom-ribbon
# A principled way to achieve what you want is to fit a GAM model to your data using the gam() function in mgcv and then apply the predict() function to that model over a finer grid of values for your predictor variable. The grid can cover the span defined by the range of observed values for your predictor variable.
# load R packages
library(ggplot2)
library(mgcv)
SmoothRibbon <- function(datafilename, col_name) {
data <- as.data.frame(
# carbchem.MEANS.by.day %>%
datafilename %>%
na.omit() %>%
# dplyr::filter(!Type %in% 'Larvae') %>carbchem.MASTER_MEANS.MONTLY%
dplyr::filter(pCO2_treatment %in% c("Low", "Moderate")) %>%
dplyr::filter(variable %in% (
# 'Temperature_bucket_C',
# 'Salinity',
# 'DO_mg_l',
# 'pH',
# 'pH_out'
col_name
# 'TCO2_mmol_kgSW'
# 'TA_mmol_kgSW',
# 'pCO2_out_matm'
#'War_out_DIC_pH'
# 'Wca_out'
))
) %>%
mutate(Date_asnum = dense_rank(Date))
# calc the num days because the Date_asnumin ascending order dot not
# represent the elapsed time properly as an x axis
data$NumDays  <- as.numeric(
difftime(as.Date(data$Date),
as.Date(data$Date[1]),
units="days")
)
data.low      <- data %>% dplyr::filter(pCO2_treatment %in% 'Low')
data.moderate <- data %>% dplyr::filter(pCO2_treatment %in% 'Moderate')
data.all.ordered  <- rbind(data.low, data.moderate)
# fit GAM model
m.low      <- gam(mean ~ s(NumDays), data = data.low)
m.moderate <- gam(mean ~ s(NumDays), data = data.moderate)
# define finer grid of predictor values
xnew.low      <- seq(min(data.low$NumDays),
max(data.low$NumDays), by = 0.1)
xnew.moderate <- seq(min(data.moderate$NumDays),
max(data.moderate$NumDays), by = 0.1)
# apply predict() function to the fitted GAM model
# using the finer grid of x values
p.low      <- predict(m.low, newdata = data.frame(NumDays = xnew.low), se = TRUE)
p.moderate <- predict(m.moderate, newdata = data.frame(NumDays = xnew.moderate), se = TRUE)
# plot the estimated mean values of y (fit) at given x values
# over the finer grid of x values;
# superimpose approximate 95% confidence band for the true
# mean values of y at given x values in the finer grid
g.low <- data.frame(NumDays = xnew.low,
fit = p.low$fit,
lwr = p.low$fit - 1.96*p.low$se.fit, # 1.96 * SE = 95% CI
upr = p.low$fit + 1.96*p.low$se.fit  # 1.96 * SE = 95% CI
) %>%
dplyr::mutate(pCO2_treatment = "Low")
g.moderate <- data.frame(NumDays = xnew.moderate,
fit = p.moderate$fit,
lwr = p.moderate$fit - 1.96*p.moderate$se.fit,
upr = p.moderate$fit + 1.96*p.moderate$se.fit) %>%
dplyr::mutate(pCO2_treatment = "Moderate")
# r bind the data sets
# use the first date of data and add the elapsed numberic time, not that 1 = seconds, we
# convert to days by mutliplying by 86400 (seconds in a day)
g.master <- rbind(g.low, g.moderate) %>%
dplyr::mutate(Date = data$Date[1] + NumDays*86400)
theme_set(theme_classic())
p <- ggplot(data = g.master, aes(Date, fit)) +
geom_ribbon(aes(ymin = lwr, ymax = upr, fill=factor(pCO2_treatment)), alpha = 0.2) +
geom_line(aes(y = lwr,
colour=factor(pCO2_treatment)),
linetype = "solid") +
geom_line(aes(y = upr,
colour=factor(pCO2_treatment)),
linetype = "solid") +
geom_point(data = data.all.ordered,
aes(Date, mean,
colour=factor(pCO2_treatment)),
shape = 3, size =1) +
ylab(col_name) +
theme(legend.position="none") +
#scale_fill_manual(values=c("forestgreen", "orange"), name="fill") +
#scale_colour_manual(values=c("forestgreen", "orange"), name="fill")
scale_fill_manual(values=c("#739D73", "#D7A67F"), name="fill") +
scale_colour_manual(values=c("#739D73", "#D7A67F"), name="fill")
print(p)
}
carbchem.MEANS.by.day.F2         <- carbchem.MEANS.by.day %>% filter(Generation %in% 'F2')# Assembled from Geneive with go ahead years ago...
SmoothRibbon(carbchem.MEANS.by.day.F2, "Temperature_bucket_C")
SmoothRibbon(carbchem.MEANS.by.day.F2, "Salinity")
carbchem.MEANS.by.day.F2
p <- ggplot(data = g.master, aes(Date, fit)) +
geom_ribbon(aes(ymin = lwr, ymax = upr, fill=factor(pCO2_treatment)), alpha = 0.2) +
geom_line(aes(y = lwr,
colour=factor(pCO2_treatment)),
linetype = "solid") +
geom_line(aes(y = upr,
colour=factor(pCO2_treatment)),
linetype = "solid") +
geom_point(data = data.all.ordered,
aes(Date, mean,
colour=factor(pCO2_treatment)),
shape = 3, size =1) +
ylab(col_name) +
theme(legend.position="none") +
#scale_fill_manual(values=c("forestgreen", "orange"), name="fill") +
#scale_colour_manual(values=c("forestgreen", "orange"), name="fill")
scale_fill_manual(values=c("#739D73", "#D7A67F", "darkred"), name="fill") +
scale_colour_manual(values=c("#739D73", "#D7A67F", "darkred"), name="fill")
SmoothRibbon <- function(datafilename, col_name) {
data <- as.data.frame(
# carbchem.MEANS.by.day %>%
datafilename %>%
na.omit() %>%
# dplyr::filter(!Type %in% 'Larvae') %>carbchem.MASTER_MEANS.MONTLY%
dplyr::filter(pCO2_treatment %in% c("Low", "Moderate")) %>%
dplyr::filter(variable %in% (
# 'Temperature_bucket_C',
# 'Salinity',
# 'DO_mg_l',
# 'pH',
# 'pH_out'
col_name
# 'TCO2_mmol_kgSW'
# 'TA_mmol_kgSW',
# 'pCO2_out_matm'
#'War_out_DIC_pH'
# 'Wca_out'
))
) %>%
mutate(Date_asnum = dense_rank(Date))
# calc the num days because the Date_asnumin ascending order dot not
# represent the elapsed time properly as an x axis
data$NumDays  <- as.numeric(
difftime(as.Date(data$Date),
as.Date(data$Date[1]),
units="days")
)
data.low      <- data %>% dplyr::filter(pCO2_treatment %in% 'Low')
data.moderate <- data %>% dplyr::filter(pCO2_treatment %in% 'Moderate')
data.all.ordered  <- rbind(data.low, data.moderate)
# fit GAM model
m.low      <- gam(mean ~ s(NumDays), data = data.low)
m.moderate <- gam(mean ~ s(NumDays), data = data.moderate)
# define finer grid of predictor values
xnew.low      <- seq(min(data.low$NumDays),
max(data.low$NumDays), by = 0.1)
xnew.moderate <- seq(min(data.moderate$NumDays),
max(data.moderate$NumDays), by = 0.1)
# apply predict() function to the fitted GAM model
# using the finer grid of x values
p.low      <- predict(m.low, newdata = data.frame(NumDays = xnew.low), se = TRUE)
p.moderate <- predict(m.moderate, newdata = data.frame(NumDays = xnew.moderate), se = TRUE)
# plot the estimated mean values of y (fit) at given x values
# over the finer grid of x values;
# superimpose approximate 95% confidence band for the true
# mean values of y at given x values in the finer grid
g.low <- data.frame(NumDays = xnew.low,
fit = p.low$fit,
lwr = p.low$fit - 1.96*p.low$se.fit, # 1.96 * SE = 95% CI
upr = p.low$fit + 1.96*p.low$se.fit  # 1.96 * SE = 95% CI
) %>%
dplyr::mutate(pCO2_treatment = "Low")
g.moderate <- data.frame(NumDays = xnew.moderate,
fit = p.moderate$fit,
lwr = p.moderate$fit - 1.96*p.moderate$se.fit,
upr = p.moderate$fit + 1.96*p.moderate$se.fit) %>%
dplyr::mutate(pCO2_treatment = "Moderate")
# r bind the data sets
# use the first date of data and add the elapsed numberic time, not that 1 = seconds, we
# convert to days by mutliplying by 86400 (seconds in a day)
g.master <- rbind(g.low, g.moderate) %>%
dplyr::mutate(Date = data$Date[1] + NumDays*86400)
theme_set(theme_classic())
p <- ggplot(data = g.master, aes(Date, fit)) +
geom_ribbon(aes(ymin = lwr, ymax = upr, fill=factor(pCO2_treatment)), alpha = 0.2) +
geom_line(aes(y = lwr,
colour=factor(pCO2_treatment)),
linetype = "solid") +
geom_line(aes(y = upr,
colour=factor(pCO2_treatment)),
linetype = "solid") +
geom_point(data = data.all.ordered,
aes(Date, mean,
colour=factor(pCO2_treatment)),
shape = 3, size =1) +
ylab(col_name) +
theme(legend.position="none") +
#scale_fill_manual(values=c("forestgreen", "orange"), name="fill") +
#scale_colour_manual(values=c("forestgreen", "orange"), name="fill")
scale_fill_manual(values=c("#739D73", "#D7A67F", "darkred"), name="fill") +
scale_colour_manual(values=c("#739D73", "#D7A67F", "darkred"), name="fill")
print(p)
}
SmoothRibbon(carbchem.MEANS.by.day.F2, "Temperature_bucket_C")
SmoothRibbon(carbchem.MEANS.by.day.F2, "WAr_out")
carbchem.MEANS.by.day.F2
SmoothRibbon_three <- function(datafilename, col_name) {
data <- as.data.frame(
# carbchem.MEANS.by.day %>%
datafilename %>%
na.omit() %>%
# dplyr::filter(!Type %in% 'Larvae') %>carbchem.MASTER_MEANS.MONTLY%
dplyr::filter(pCO2_treatment %in% c("Low", "Moderate", "Severe")) %>%
dplyr::filter(variable %in% (
# 'Temperature_bucket_C',
# 'Salinity',
# 'DO_mg_l',
# 'pH',
# 'pH_out'
col_name
# 'TCO2_mmol_kgSW'
# 'TA_mmol_kgSW',
# 'pCO2_out_matm'
#'War_out_DIC_pH'
# 'Wca_out'
))
) %>%
mutate(Date_asnum = dense_rank(Date))
# calc the num days because the Date_asnumin ascending order dot not
# represent the elapsed time properly as an x axis
data$NumDays  <- as.numeric(
difftime(as.Date(data$Date),
as.Date(data$Date[1]),
units="days")
)
data.low      <- data %>% dplyr::filter(pCO2_treatment %in% 'Low')
data.moderate <- data %>% dplyr::filter(pCO2_treatment %in% 'Moderate')
data.high     <- data %>% dplyr::filter(pCO2_treatment %in% 'Severe')
data.all.ordered  <- rbind(data.low, data.moderate, data.high)
# fit GAM model
m.low      <- gam(mean ~ s(NumDays), data = data.low)
m.moderate <- gam(mean ~ s(NumDays), data = data.moderate)
m.high     <- gam(mean ~ s(NumDays), data = data.high)
# define finer grid of predictor values
xnew.low      <- seq(min(data.low$NumDays),
max(data.low$NumDays), by = 0.1)
xnew.moderate <- seq(min(data.moderate$NumDays),
max(data.moderate$NumDays), by = 0.1)
xnew.high     <- seq(min(data.high$NumDays),
max(data.high$NumDays), by = 0.1)
# apply predict() function to the fitted GAM model
# using the finer grid of x values
p.low      <- predict(m.low, newdata = data.frame(NumDays = xnew.low), se = TRUE)
p.moderate <- predict(m.moderate, newdata = data.frame(NumDays = xnew.moderate), se = TRUE)
p.high     <- predict(m.high, newdata = data.frame(NumDays = xnew.high), se = TRUE)
# plot the estimated mean values of y (fit) at given x values
# over the finer grid of x values;
# superimpose approximate 95% confidence band for the true
# mean values of y at given x values in the finer grid
g.low <- data.frame(NumDays = xnew.low,
fit = p.low$fit,
lwr = p.low$fit - 1.96*p.low$se.fit, # 1.96 * SE = 95% CI
upr = p.low$fit + 1.96*p.low$se.fit  # 1.96 * SE = 95% CI
) %>%
dplyr::mutate(pCO2_treatment = "Low")
g.moderate <- data.frame(NumDays = xnew.moderate,
fit = p.moderate$fit,
lwr = p.moderate$fit - 1.96*p.moderate$se.fit,
upr = p.moderate$fit + 1.96*p.moderate$se.fit) %>%
dplyr::mutate(pCO2_treatment = "Moderate")
g.high    <- data.frame(NumDays = xnew.high,
fit = p.high$fit,
lwr = p.high$fit - 1.96*p.high$se.fit,
upr = p.high$fit + 1.96*p.high$se.fit) %>%
dplyr::mutate(pCO2_treatment = "Severe")
# r bind the data sets
# use the first date of data and add the elapsed numberic time, not that 1 = seconds, we
# convert to days by mutliplying by 86400 (seconds in a day)
g.master <- rbind(g.low, g.moderate, g.high) %>%
dplyr::mutate(Date = data$Date[1] + NumDays*86400)
theme_set(theme_classic())
p <- ggplot(data = g.master, aes(Date, fit)) +
geom_ribbon(aes(ymin = lwr, ymax = upr, fill=factor(pCO2_treatment)), alpha = 0.2) +
geom_line(aes(y = lwr,
colour=factor(pCO2_treatment)),
linetype = "solid") +
geom_line(aes(y = upr,
colour=factor(pCO2_treatment)),
linetype = "solid") +
geom_point(data = data.all.ordered,
aes(Date, mean,
colour=factor(pCO2_treatment)),
shape = 3, size =1) +
ylab(col_name) +
theme(legend.position="none") +
#scale_fill_manual(values=c("forestgreen", "orange"), name="fill") +
#scale_colour_manual(values=c("forestgreen", "orange"), name="fill")
scale_fill_manual(values=c("#739D73", "#D7A67F", "darkred"), name="fill") +
scale_colour_manual(values=c("#739D73", "#D7A67F", "darkred"), name="fill")
print(p)
}
SmoothRibbon_three(carbchem.MEANS.by.day.F2, "Temperature_bucket_C")
ggarrange(
SmoothRibbon_three(carbchem.MEANS.by.day.F2, "Temperature_bucket_C"),
SmoothRibbon_three(carbchem.MEANS.by.day.F2, "Salinity"),
SmoothRibbon_three(carbchem.MEANS.by.day.F2, "pCO2_out_matm"),
SmoothRibbon_three(carbchem.MEANS.by.day.F2, "pH_out"),
SmoothRibbon_three(carbchem.MEANS.by.day.F2, "WAr_out"),
SmoothRibbon_three(carbchem.MEANS.by.day.F2, "WCa_out"),
nrow = 3,
ncol = 2
)
pdf("C:/Users/samuel.gurr/Documents/Github_repositories/EAD-ASEB-Airradians_F1F2_Growout_OA/RAnalysis/Output/SeawaterChemistry/F2/plots/F2_lowmodhigh_Chem_95CI.pdf", width=8, height=11)
ggarrange(
SmoothRibbon_three(carbchem.MEANS.by.day.F2, "Temperature_bucket_C"),
SmoothRibbon_three(carbchem.MEANS.by.day.F2, "Salinity"),
SmoothRibbon_three(carbchem.MEANS.by.day.F2, "pCO2_out_matm"),
SmoothRibbon_three(carbchem.MEANS.by.day.F2, "pH_out"),
SmoothRibbon_three(carbchem.MEANS.by.day.F2, "WAr_out"),
SmoothRibbon_three(carbchem.MEANS.by.day.F2, "WCa_out"),
nrow = 3,
ncol = 2
)
graphics.off()
pdf("C:/Users/samjg/Documents/Github_repositories/EAD-ASEB-Airradians_F1F2_Growout_OA/RAnalysis/Output/SeawaterChemistry/F2/plots/F2_lowmodhigh_Chem_95CI.pdf", width=8, height=11)
ggarrange(
SmoothRibbon_three(carbchem.MEANS.by.day.F2, "Temperature_bucket_C"),
SmoothRibbon_three(carbchem.MEANS.by.day.F2, "Salinity"),
SmoothRibbon_three(carbchem.MEANS.by.day.F2, "pCO2_out_matm"),
SmoothRibbon_three(carbchem.MEANS.by.day.F2, "pH_out"),
SmoothRibbon_three(carbchem.MEANS.by.day.F2, "WAr_out"),
SmoothRibbon_three(carbchem.MEANS.by.day.F2, "WCa_out"),
nrow = 3,
ncol = 2
)
graphics.off()
pdf("C:/Users/samjg/Documents/Github_repositories/EAD-ASEB-Airradians_F1F2_Growout_OA/RAnalysis/Output/SeawaterChemistry/F2/plots/F2_lowmod_Chem_95CI.pdf", width=8, height=11)
ggarrange(
SmoothRibbon(carbchem.MEANS.by.day.F2, "Temperature_bucket_C"),
SmoothRibbon(carbchem.MEANS.by.day.F2, "Salinity"),
SmoothRibbon(carbchem.MEANS.by.day.F2, "pCO2_out_matm"),
SmoothRibbon(carbchem.MEANS.by.day.F2, "pH_out"),
SmoothRibbon(carbchem.MEANS.by.day.F2, "WAr_out"),
SmoothRibbon(carbchem.MEANS.by.day.F2, "WCa_out"),
nrow = 3,
ncol = 2
)
graphics.off()
